version: "0.2"

# Ubuntu 22.04 specific overrides for terraform binary installation
binaries:
  - name: "main"
    url: "https://releases.hashicorp.com/terraform/{{version}}/terraform_{{version}}_linux_amd64.zip"
    architecture: "amd64"
    platform: "linux"
    checksum: "sha256:b8a3892c58c33ee2b4b8e7c2c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8"
    install_path: "/usr/local/bin"
    executable: "terraform"
    permissions: "0755"
    archive:
      format: "zip"
      strip_prefix: ""
      extract_path: "/tmp/sai-terraform-extract"
    custom_commands:
      download: "wget -O terraform_{{version}}_linux_amd64.zip {{url}} && echo '{{checksum}}  terraform_{{version}}_linux_amd64.zip' | sha256sum -c"
      extract: "unzip -o terraform_{{version}}_linux_amd64.zip -d {{archive.extract_path}}"
      install: "cp {{archive.extract_path}}/terraform {{install_path}}/terraform && chmod {{permissions}} {{install_path}}/terraform && ln -sf {{install_path}}/terraform /usr/bin/terraform"
      uninstall: "rm -f {{install_path}}/terraform /usr/bin/terraform"
      validation: "{{install_path}}/terraform version && which terraform"
      version: "{{install_path}}/terraform version | head -n1 | grep -o 'v[0-9.]*'"

providers:
  binary:
    binaries:
      - name: "main"
        url: "https://releases.hashicorp.com/terraform/{{version}}/terraform_{{version}}_linux_amd64.zip"
        architecture: "amd64"
        platform: "linux"
        checksum: "sha256:b8a3892c58c33ee2b4b8e7c2c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8c8"
        install_path: "/usr/local/bin"
        executable: "terraform"
        permissions: "0755"
        archive:
          format: "zip"
          strip_prefix: ""
          extract_path: "/tmp/sai-terraform-extract"
        custom_commands:
          download: "wget -O terraform_{{version}}_linux_amd64.zip {{url}} && echo '{{checksum}}  terraform_{{version}}_linux_amd64.zip' | sha256sum -c"
          extract: "unzip -o terraform_{{version}}_linux_amd64.zip -d {{archive.extract_path}}"
          install: "cp {{archive.extract_path}}/terraform {{install_path}}/terraform && chmod {{permissions}} {{install_path}}/terraform && ln -sf {{install_path}}/terraform /usr/bin/terraform"
          uninstall: "rm -f {{install_path}}/terraform /usr/bin/terraform"
          validation: "{{install_path}}/terraform version && which terraform"
          version: "{{install_path}}/terraform version | head -n1 | grep -o 'v[0-9.]*'"